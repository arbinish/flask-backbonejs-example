var User=Backbone.Model.extend({urlRoot:"/user",defaults:{id:"",name:"",email:""},initialize:function(){this.bind("change",this.update)},update:function(a){console.log("update event fired",a);this.hasChanged("email")&&this.save()}}),Users=Backbone.Collection.extend({url:"/users",model:User}),UserView=Backbone.View.extend({tagName:"li",className:"user",initialize:function(){this.render()},render:function(){var a=this.model.get("name");this.model.get("email");var b=this.model.get("id");this.$el.append('<a class="name" href="#user/'+
b+'">'+a+"</span>");this.$el.append('<span class="email" contenteditable="true">'+this.model.get("email")+"</span>")},events:{"click .email":"editUser"},editUser:function(){var a=this;this.$el.on("blur","[contenteditable]",function(){var b=$(this).text().trim();a.model.set("email",b);console.log("changed email to",b)})}}),AppView=Backbone.View.extend({tagName:"ul",className:"users",initialize:function(){this.render()},render:function(){var a;this.collection.forEach(function(b){a=new UserView({model:b});
this.$el.append(a.el)},this)}}),AppRouter=Backbone.Router.extend({routes:{"user/:id":"showUser","*path":"index"}});
$(document).ready(function(){var a=new Users,b=new AppRouter;b.on("route:showUser",function(a){var b=new User({id:parseInt(a)});b.fetch({success:function(){console.log("route",b.toJSON());var a=new UserView({model:b,tagName:"div",className:"editor"});console.log("markup",a.el);$("body").html(a.el)},silent:!0})});b.on("route:index",function(){a.fetch({success:function(){var b=new AppView({collection:a});console.log("Appending to main body");$("body").html(b.$el)}})});Backbone.history.start()});
